generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model categories {
  category_id Int       @id @default(autoincrement())
  name        String    @unique @db.VarChar(100)
  description String?
  courses     courses[]
}

model certificates {
  certificate_id  Int       @id @default(autoincrement())
  user_id         Int?
  course_id       Int?
  issued_at       DateTime? @default(now()) @db.Timestamp(6)
  certificate_url String?
  courses         courses?  @relation(fields: [course_id], references: [course_id], onDelete: Cascade, onUpdate: NoAction)
  users           users?    @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, course_id], map: "idx_certificates_user_course")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model courses {
  course_id        Int            @id @default(autoincrement())
  title            String         @db.VarChar(150)
  description      String?
  category_id      Int?
  instructor_id    Int?
  price            Decimal?       @default(0) @db.Decimal(10, 2)
  created_at       DateTime?      @default(now()) @db.Timestamp(6)
  updated_at       DateTime?      @default(now()) @db.Timestamp(6)
  difficulty_level String?        @db.VarChar(20)
  avg_rating       Decimal?       @default(0) @db.Decimal(3, 2)
  review_count     Int?           @default(0)
  certificates     certificates[]
  categories       categories?    @relation(fields: [category_id], references: [category_id], onUpdate: NoAction)
  users            users?         @relation(fields: [instructor_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
  enrollments      enrollments[]
  lessons          lessons[]
  payments         payments[]
  reviews          reviews[]

  @@index([category_id], map: "idx_courses_category")
  @@index([title], map: "idx_courses_title")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model enrollments {
  enrollment_id Int       @id @default(autoincrement())
  user_id       Int?
  course_id     Int?
  enrolled_at   DateTime? @default(now()) @db.Timestamp(6)
  progress      Decimal?  @default(0) @db.Decimal(5, 2)
  courses       courses?  @relation(fields: [course_id], references: [course_id], onDelete: Cascade, onUpdate: NoAction)
  users         users?    @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, course_id])
  @@index([course_id], map: "idx_enrollments_course")
  @@index([user_id], map: "idx_enrollments_user")
}

model lessons {
  lesson_id  Int       @id @default(autoincrement())
  course_id  Int?
  title      String    @db.VarChar(150)
  content    String?
  position   Int?      @default(1)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  video_url  String?
  image_url  String?
  test       Json?
  courses    courses?  @relation(fields: [course_id], references: [course_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([course_id], map: "idx_lessons_course")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model payments {
  payment_id   Int       @id @default(autoincrement())
  user_id      Int?
  course_id    Int?
  amount       Decimal   @db.Decimal(10, 2)
  status       String?   @default("pending") @db.VarChar(20)
  payment_date DateTime? @default(now()) @db.Timestamp(6)
  courses      courses?  @relation(fields: [course_id], references: [course_id], onDelete: Cascade, onUpdate: NoAction)
  users        users?    @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([course_id], map: "idx_payments_course")
  @@index([status], map: "idx_payments_status")
  @@index([user_id], map: "idx_payments_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model reviews {
  review_id  Int       @id @default(autoincrement())
  course_id  Int?
  user_id    Int?
  rating     Int?
  comment    String?
  created_at DateTime? @default(now()) @db.Timestamp(6)
  courses    courses?  @relation(fields: [course_id], references: [course_id], onDelete: Cascade, onUpdate: NoAction)
  users      users?    @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([course_id, user_id])
  @@index([course_id], map: "idx_reviews_course")
  @@index([rating], map: "idx_reviews_rating")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model users {
  user_id       String         @id
  firstName String             @map("first_name")
  surname   String             @map("sur_name")
  email         String         @unique @db.VarChar(100)
  password_hash String
  role          String?        @default("student") @db.VarChar(20)
  created_at    DateTime?      @default(now()) @db.Timestamp(6)
  certificates  certificates[]
  courses       courses[]
  enrollments   enrollments[]
  payments      payments[]
  reviews       reviews[]

  @@index([email], map: "idx_users_email")
}
